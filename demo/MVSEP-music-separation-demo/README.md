# 项目文档：音频分离工具 (MVSEP-MDX23) 🎶

## 简介
该项目使用 **MVSEP-MDX23** 模型进行音频分离，旨在将音频文件中的人声、伴奏、乐器等成分进行分离，以便于进一步的处理与分析🎧。该工具依赖于 **FFmpeg** 进行音频处理，包括音频切割和合并，以及使用深度学习模型进行音频分离。用户可以选择在 CPU 或 GPU 上执行音频分离任务，并可以通过调整不同的参数来优化处理性能和结果✨。

## 功能
1. **音频分割**：将输入的音频文件按最大时长进行切割，便于逐片段进行音频分离 ⏱️。
2. **音频分离**：使用 MVSEP-MDX23 模型对切割后的音频片段进行音频分离，包括提取人声、伴奏及乐器部分 🎤🎸。
3. **音频合并**：将分离后的音频片段按顺序合并成完整的音频文件 🎶。
4. **可定制化设置**：支持选择模型类型、音频切割方式、GPU/CPU 设置等，提供灵活的控制 🔧。
5. **临时文件清理**：自动清理音频分割过程中产生的临时文件 🧹。

## 使用说明

### 命令行参数

1. **--audio_file**：指定输入音频文件的路径，要求为 WAV 格式 (必选参数)。
2. **--max_segment_duration**：指定音频分割的最大时长，默认为 60 秒。
3. **--cpu**：是否使用 CPU 进行处理。默认为使用 GPU。如果选择该选项，将会在 CPU 上执行，处理速度较慢 🐢。
4. **--overlap_large** 和 **--overlap_small**：控制音频切割时的重叠比例。值接近 1.0 会使音频切割更慢，但提高结果精度 ⚖️。
5. **--single_onnx**：是否仅使用单一的 ONNX 模型进行音频分离。此选项适用于内存较小的设备 📱。
6. **--chunk_size**：指定 ONNX 模型的音频切割大小。设置较小的值可以减少 GPU 内存消耗，默认为 1000000。
7. **--large_gpu**：如果有较大 GPU 可用，选择该选项以加速多个音频文件的处理 🚀。
8. **--use_kim_model_1**：是否使用 Kim 模型的第一个版本（与比赛时的版本相同）。
9. **--only_vocals**：是否仅生成人声和伴奏部分，跳过贝斯、鼓声等其他部分 🎤🎧。

### 代码解释

#### `split_audio(audio_path, max_duration)`
- **功能**：将输入的音频文件 `audio_path` 按照指定的 `max_duration`（最大时长）进行切割。
- **返回值**：返回切割后的音频文件路径列表，以及临时文件存储目录路径。

#### `create_file_list(directory, endswith)`
- **功能**：在指定的 `directory` 目录下，查找所有符合条件的音频文件（以 `.wav` 结尾的文件），并将其路径写入 `file_list.txt` 文件。
- **返回值**：返回文件列表的路径。

#### `merge_wavs_ffmpeg(file_list_path, merge_wav_name, directory)`
- **功能**：使用 FFmpeg 将分离后的音频文件合并成一个完整的文件。
- **参数**：
  - `file_list_path`：包含音频文件路径的文本文件。
  - `merge_wav_name`：合并后音频文件的名称。
  - `directory`：音频文件所在目录。
  
#### `clean_up_temp_files(temp_dir)`
- **功能**：清理临时文件夹 `temp_dir`，删除分割音频过程中生成的临时文件。

#### `main()`
- **功能**：主程序，解析命令行参数并协调音频分割、音频分离、合并音频等操作。

### 致谢
本项目借鉴了 [MVSEP-MDX23](https://github.com/ZFTurbo/MVSEP-MDX23-music-separation-model) 项目，其提供了强大的音频分离模型和方法，特此感谢 🙏。

### 注意事项
- 如果你选择使用 GPU，请确保你有足够的 GPU 内存，否则可以选择使用 CPU 来进行处理 🧠。
- 如果音频分离的速度较慢，可以尝试调整切割片段的大小和重叠比例，以优化处理效率 ⚡。

